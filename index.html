<!DOCTYPE html>
<html lang="en" data-theme="light" data-palette="morandi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CataChess Workspace</title>
  <meta name="description" content="CataChess Workspace" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Space+Grotesk:wght@400;600&family=IBM+Plex+Mono&display=swap" rel="stylesheet" />
</head>
<body>
  <div id="app"></div>

  <!-- Authentication Check -->
  <script>
    // Check if user is authenticated
    const token = localStorage.getItem('catachess_token') || sessionStorage.getItem('catachess_token');
    const userId = localStorage.getItem('catachess_user_id') || sessionStorage.getItem('catachess_user_id');

    if (!token || !userId) {
      // Not authenticated, redirect to login
      window.location.href = '/frontend/ui/modules/login/layout/LoginPage.html?redirect=/workspace-select.html';
    } else {
      // Check if workspace ID is provided in URL
      const urlParams = new URLSearchParams(window.location.search);
      const workspaceId = urlParams.get('workspace');

      if (!workspaceId) {
        // No workspace selected, redirect to workspace selection
        window.location.href = '/frontend/workspace-select.html';
      } else {
        // Store workspace ID for the app
        sessionStorage.setItem('current_workspace_id', workspaceId);

        // Dispatch SESSION_SET event for workspace app
        window.addEventListener('DOMContentLoaded', () => {
          // This will be picked up by the workspace app
          if (window.store) {
            window.store.dispatch({
              type: 'SESSION_SET',
              payload: { userId, token }
            });
          }
        });
      }
    }
  </script>

  <script type="module" src="/frontend/ui/modules/workspace/assets/workspace-app.js"></script>
</body>
</html>
